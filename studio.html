<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webneva Studio ‚Äì AI f√∂r webbutvecklare</title>
  <link rel="icon" href="images/webneva-logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #1e293b;
    }
    .glass {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    .brand { color: #0f4c81; }
    .brand-bg { background-color: #0f4c81; }
    .brand-bg:hover { background-color: #0c3b63; }
    .chat-bubble {
      border-radius: 1rem;
      padding: .75rem 1rem;
      margin-bottom: .75rem;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .chat-ai { background-color: #f1f5f9; align-self: flex-start; }
    .chat-user { background-color: #0f4c81; color: white; align-self: flex-end; }
    textarea::-webkit-scrollbar, #chatBox::-webkit-scrollbar {
      width: 8px;
    }
    textarea::-webkit-scrollbar-thumb, #chatBox::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.1);
      border-radius: 8px;
    }
  </style>
</head>
<body class="antialiased">

  <!-- Header -->
  <header class="fixed top-0 left-0 w-full z-40 glass border-b border-slate-200">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-6 py-3">
      <div class="flex items-center gap-3">
        <img src="images/webneva-logo.png" alt="Webneva" class="h-10 w-10 object-contain">
        <span class="font-extrabold text-xl md:text-2xl brand">Webneva<span class="text-blue-500"> Studio</span></span>
      </div>
      <div class="relative">
        <button id="profileBtn" class="flex items-center gap-2 bg-white border rounded-full px-4 py-2 text-sm shadow hover:shadow-md transition">
          <i class="fa-solid fa-user text-slate-700"></i>
          <span>Profil</span>
          <i class="fa-solid fa-chevron-down text-xs"></i>
        </button>
        <div id="profileMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-slate-100 z-50">
          <a href="/" class="block px-4 py-2 text-sm hover:bg-blue-50">üè† Till startsida</a>
          <a href="#" class="block px-4 py-2 text-sm hover:bg-blue-50">‚öôÔ∏è Inst√§llningar</a>
          <hr>
          <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">üö™ Logga ut</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 flex flex-col items-center justify-center pt-28 pb-16 px-4">
    <div class="w-full max-w-5xl glass rounded-2xl p-6 md:p-10 flex flex-col lg:flex-row gap-8">

      <!-- Input / kodruta -->
      <section class="flex-1 flex flex-col">
        <h2 class="font-bold text-lg mb-3 text-[#0f4c81] flex items-center gap-2"><i class="fa-solid fa-code"></i> Din kod</h2>
        <textarea id="userCode" class="flex-1 border rounded-lg p-4 bg-white font-mono text-sm resize-none focus:ring-2 focus:ring-blue-400" rows="12" placeholder="Klistra in din HTML/CSS/JS h√§r..."></textarea>
        <div class="mt-4 flex gap-3 justify-end">
          <button id="previewBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">Visa live</button>
          <button id="sendMessageBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition">‚ú® F√∂rb√§ttra med AI</button>
        </div>
      </section>

      <!-- AI sektion -->
      <section class="flex-1 flex flex-col">
        <h2 class="font-bold text-lg mb-3 text-[#0f4c81] flex items-center gap-2"><i class="fa-solid fa-wand-magic-sparkles"></i> AI-assistent</h2>
        <div id="chatBox" class="flex flex-col flex-1 overflow-y-auto border rounded-lg bg-white p-4 text-sm font-sans mb-4 h-[350px]">
          <div class="chat-bubble chat-ai">üëã Hej! Jag √§r din AI-assistent. Klistra in kod till v√§nster eller skriv ett meddelande nedan.</div>
        </div>
        <textarea id="userMessage" class="w-full border rounded-lg p-3 text-sm mb-3 resize-none focus:ring-2 focus:ring-blue-400" rows="2" placeholder="Skriv till AI (t.ex. 'G√∂r knappen bl√•are och centrerad')..."></textarea>
        <button id="sendChatBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">Skicka</button>
      </section>

    </div>
  </main>

  <!-- Script -->
  <script>
  // Profilmeny
  document.getElementById("profileBtn").addEventListener("click", () => {
    document.getElementById("profileMenu").classList.toggle("hidden");
  });

  // Live Preview
  document.getElementById("previewBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value;
    const win = window.open("", "_blank");
    win.document.write(code);
    win.document.close();
  });

  // AI Kommunikation
  async function sendToAI(message) {
    const chatBox = document.getElementById("chatBox");
    const userDiv = document.createElement("div");
    userDiv.className = "chat-bubble chat-user";
    userDiv.innerText = message;
    chatBox.appendChild(userDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    const thinking = document.createElement("div");
    thinking.className = "chat-bubble chat-ai italic text-gray-500";
    thinking.innerText = "‚è≥ AI bearbetar...";
    chatBox.appendChild(thinking);
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
      const res = await fetch("/api/openai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      chatBox.removeChild(thinking);
      const aiDiv = document.createElement("div");
      aiDiv.className = "chat-bubble chat-ai";
      aiDiv.innerText = data.reply || "‚ö†Ô∏è AI kunde inte svara.";
      chatBox.appendChild(aiDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (err) {
      chatBox.removeChild(thinking);
      const errDiv = document.createElement("div");
      errDiv.className = "chat-bubble chat-ai text-red-500";
      errDiv.innerText = "‚ùå Fel vid kontakt med AI-servern.";
      chatBox.appendChild(errDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  }

  document.getElementById("sendMessageBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value.trim();
    if (!code) return alert("Klistra in din kod f√∂rst!");
    sendToAI("F√∂rb√§ttra f√∂ljande kod:\n" + code);
  });

  document.getElementById("sendChatBtn").addEventListener("click", () => {
    const msg = document.getElementById("userMessage").value.trim();
    if (!msg) return alert("Skriv n√•got f√∂rst!");
    document.getElementById("userMessage").value = "";
    sendToAI(msg);
  });
  </script>

</body>
</html>
