<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Webneva Studio ‚Äì AI-driven webbutveckling</title>
  <link rel="icon" href="images/webneva-logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      background: linear-gradient(135deg, #f7faff, #edf2fb);
    }
    .brand-bg { background-color: #0f4c81; }
    .brand-bg:hover { background-color: #0c3b63; }
    .glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(12px); }
    .chat-bubble { border-radius: 1rem; padding: .75rem 1rem; margin-bottom: .75rem; word-wrap: break-word; white-space: pre-wrap; }
    .chat-ai { background-color: #f1f5f9; align-self: flex-start; }
    .chat-user { background-color: #0f4c81; color: white; align-self: flex-end; }
  </style>
</head>
<body class="antialiased flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 glass border-r border-slate-200 shadow-lg flex flex-col justify-between fixed inset-y-0 left-0 z-40">
    <div>
      <div class="flex items-center gap-3 px-6 py-5 border-b border-slate-200">
        <img src="images/webneva-logo.png" class="h-10 w-10" alt="Webneva logo">
        <span class="font-extrabold text-xl text-[#0f4c81]">Webneva</span>
      </div>
      <nav class="mt-6 flex flex-col">
        <a href="/" class="px-6 py-3 flex items-center gap-3 text-slate-700 hover:bg-blue-50">
          <i class="fa-solid fa-house"></i> <span>Startsida</span>
        </a>
        <a href="/studio" class="px-6 py-3 flex items-center gap-3 bg-blue-100 text-[#0f4c81] font-semibold">
          <i class="fa-solid fa-code"></i> <span>Studio</span>
        </a>
        <a href="/settings" class="px-6 py-3 flex items-center gap-3 text-slate-700 hover:bg-blue-50">
          <i class="fa-solid fa-gear"></i> <span>Inst√§llningar</span>
        </a>
      </nav>
    </div>

    <div class="border-t border-slate-200 px-6 py-4">
      <a href="#" class="flex items-center gap-3 text-slate-700 hover:text-red-600">
        <i class="fa-solid fa-right-from-bracket"></i> Logga ut
      </a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 ml-64 p-10">
    <header class="flex justify-between items-center mb-10">
      <h1 class="text-3xl font-bold text-[#0f4c81] flex items-center gap-2">
        <i class="fa-solid fa-code"></i> Webneva Studio
      </h1>
      <button id="saveProjectBtn" class="brand-bg text-white px-6 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">
        üíæ Spara projekt
      </button>
    </header>

    <div class="grid xl:grid-cols-2 gap-8">
      <!-- Kodredigerare -->
      <section class="glass rounded-2xl shadow-lg p-6 flex flex-col h-[550px]">
        <h2 class="font-semibold text-lg mb-2 flex items-center gap-2 text-[#0f4c81]">
          <i class="fa-solid fa-terminal"></i> Din kod
        </h2>
        <textarea id="userCode" class="flex-1 border rounded-lg p-3 text-sm font-mono bg-white resize-none focus:ring-2 focus:ring-blue-400" placeholder="Klistra in din HTML/CSS/JS h√§r..."></textarea>
        <div class="mt-4 flex gap-3 justify-end">
          <button id="previewBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">Visa live</button>
          <button id="sendMessageBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition">‚ú® F√∂rb√§ttra med AI</button>
        </div>
      </section>

      <!-- AI-chatt -->
      <section class="glass rounded-2xl shadow-lg p-6 flex flex-col h-[550px]">
        <h2 class="font-semibold text-lg mb-2 flex items-center gap-2 text-[#0f4c81]">
          <i class="fa-solid fa-robot"></i> AI-assistent
        </h2>
        <div id="chatBox" class="flex flex-col flex-1 overflow-y-auto border rounded-lg bg-white p-4 text-sm mb-4">
          <div class="chat-bubble chat-ai">
            üëã Hej! Klistra in din kod till v√§nster och klicka p√• <strong>‚ÄùF√∂rb√§ttra med AI‚Äù</strong> s√• hj√§lper jag dig.
          </div>
        </div>
        <textarea id="userMessage" class="w-full border rounded-lg p-2 text-sm mb-3 resize-none focus:ring-2 focus:ring-blue-400" rows="2" placeholder="Skriv till AI..."></textarea>
        <button id="sendChatBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">Skicka</button>
      </section>
    </div>
  </main>

  <script>
  // F√∂rhandsvisning
  document.getElementById("previewBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value;
    const win = window.open("", "_blank");
    win.document.open();
    win.document.write(code);
    win.document.close();
  });

  // AI-funktion
  async function sendToAI(message) {
    const chatBox = document.getElementById("chatBox");
    const userDiv = document.createElement("div");
    userDiv.className = "chat-bubble chat-user";
    userDiv.innerText = message;
    chatBox.appendChild(userDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    const thinkingDiv = document.createElement("div");
    thinkingDiv.className = "chat-bubble chat-ai italic text-gray-500";
    thinkingDiv.innerText = "‚è≥ AI bearbetar...";
    chatBox.appendChild(thinkingDiv);

    try {
      const res = await fetch("/api/openai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      chatBox.removeChild(thinkingDiv);

      const aiDiv = document.createElement("div");
      aiDiv.className = "chat-bubble chat-ai";
      aiDiv.innerText = data.reply || "‚ö†Ô∏è AI kunde inte generera n√•got svar.";
      chatBox.appendChild(aiDiv);
    } catch (err) {
      chatBox.removeChild(thinkingDiv);
      const errorDiv = document.createElement("div");
      errorDiv.className = "chat-bubble chat-ai text-red-500";
      errorDiv.innerText = "‚ùå Ett fel uppstod vid kontakt med AI-servern.";
      chatBox.appendChild(errorDiv);
    }
  }

  document.getElementById("sendMessageBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value.trim();
    if (!code) return alert("Klistra in din kod f√∂rst!");
    sendToAI("F√∂rb√§ttra f√∂ljande kod:\n" + code);
  });

  document.getElementById("sendChatBtn").addEventListener("click", () => {
    const msg = document.getElementById("userMessage").value.trim();
    if (!msg) return alert("Skriv ett meddelande f√∂rst!");
    document.getElementById("userMessage").value = "";
    sendToAI(msg);
  });
  </script>

</body>
</html>
