<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webneva Studio ‚Äì AI-driven webbutveckling</title>
  <link rel="icon" href="images/webneva-logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, sans-serif;
      background: linear-gradient(135deg, #f7faff, #e9eff8);
      color: #1e293b;
    }
    .glass {
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
    }
    .brand {
      color: #0f4c81;
    }
    .brand-bg {
      background-color: #0f4c81;
    }
    .brand-bg:hover {
      background-color: #0c3b63;
    }
    .chat-bubble {
      max-width: 80%;
      border-radius: 1rem;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .chat-ai {
      background-color: #f1f5f9;
      align-self: flex-start;
    }
    .chat-user {
      background-color: #0f4c81;
      color: white;
      align-self: flex-end;
    }
  </style>
</head>
<body class="antialiased">

  <!-- Header -->
  <header class="fixed inset-x-0 top-0 z-40 glass shadow">
    <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="images/webneva-logo.png" alt="Webneva" class="h-8 w-8 object-contain">
        <span class="font-extrabold text-lg brand">Webneva<span class="text-blue-500"> Studio</span></span>
      </div>
      <a href="index.html" class="brand-bg text-white px-4 py-2 rounded-full text-sm font-semibold shadow-sm">
        ‚Üê Tillbaka
      </a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="pt-28 pb-20 max-w-7xl mx-auto px-6 grid lg:grid-cols-2 gap-8">
    
    <!-- Kod-editor -->
    <section class="glass rounded-2xl shadow-lg p-6 flex flex-col">
      <h2 class="font-bold text-xl mb-3 flex items-center gap-2"><i class="fa-solid fa-code"></i> HTML / CSS / JS</h2>
      <textarea id="userCode" class="flex-1 border rounded-lg p-3 text-sm font-mono bg-white resize-none focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Klistra in din kod h√§r..."></textarea>
      <div class="mt-4 flex gap-3 justify-end">
        <button id="previewBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">Visa live</button>
        <button id="sendMessageBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition">‚ú® F√∂rb√§ttra med AI</button>
      </div>
    </section>

    <!-- F√∂rhandsvisning / AI-svar -->
    <section class="glass rounded-2xl shadow-lg p-6 flex flex-col">
      <h2 class="font-bold text-xl mb-3 flex items-center gap-2"><i class="fa-solid fa-wand-magic-sparkles"></i> Interagera med AI</h2>

      <!-- AI chatf√∂nster -->
      <div id="chatBox" class="flex flex-col flex-1 overflow-y-auto border rounded-lg bg-white p-4 text-sm font-sans mb-4" style="height: 400px;">
        <div class="chat-bubble chat-ai">
          üëã Hej! Klistra in din kod till v√§nster och klicka p√• <strong>"F√∂rb√§ttra med AI"</strong> s√• hj√§lper jag dig att g√∂ra den modernare och mer responsiv.
        </div>
      </div>

      <textarea id="userMessage" class="w-full border rounded-lg p-2 text-sm mb-3 resize-none focus:outline-none focus:ring-2 focus:ring-blue-400" rows="2" placeholder="Skriv till AI (t.ex. 'G√∂r knappen bl√•are och centrerad')..."></textarea>
      <button id="sendChatBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90 transition">Skicka</button>
    </section>

  </main>

  <script>
  // "Visa live" - f√∂rhandsvisning av anv√§ndarens kod
  document.getElementById("previewBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value;
    const win = window.open("", "_blank");
    win.document.open();
    win.document.write(code);
    win.document.close();
  });

  // AI interaktion - F√∂rb√§ttra kod
  async function sendToAI(message) {
    const chatBox = document.getElementById("chatBox");
    
    // Visa anv√§ndarens meddelande
    const userDiv = document.createElement("div");
    userDiv.className = "chat-bubble chat-user";
    userDiv.innerText = message;
    chatBox.appendChild(userDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    // Visa "AI t√§nker..."
    const thinkingDiv = document.createElement("div");
    thinkingDiv.className = "chat-bubble chat-ai italic text-gray-500";
    thinkingDiv.innerText = "‚è≥ AI bearbetar...";
    chatBox.appendChild(thinkingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
      const res = await fetch("/api/openai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });

      const data = await res.json();
      chatBox.removeChild(thinkingDiv);

      const aiDiv = document.createElement("div");
      aiDiv.className = "chat-bubble chat-ai";
      aiDiv.innerText = data.reply || "‚ö†Ô∏è AI kunde inte generera n√•got svar.";
      chatBox.appendChild(aiDiv);
      chatBox.scrollTop = chatBox.scrollHeight;

    } catch (err) {
      console.error("Fel:", err);
      chatBox.removeChild(thinkingDiv);

      const errorDiv = document.createElement("div");
      errorDiv.className = "chat-bubble chat-ai text-red-500";
      errorDiv.innerText = "‚ùå Ett fel uppstod vid kontakt med AI-servern.";
      chatBox.appendChild(errorDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  }

  // Knapp: F√∂rb√§ttra med AI
  document.getElementById("sendMessageBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value.trim();
    if (!code) return alert("Klistra in din kod f√∂rst!");
    sendToAI("F√∂rb√§ttra f√∂ljande kod:\n" + code);
  });

  // Knapp: Chatta direkt med AI
  document.getElementById("sendChatBtn").addEventListener("click", () => {
    const msg = document.getElementById("userMessage").value.trim();
    if (!msg) return alert("Skriv ett meddelande f√∂rst!");
    document.getElementById("userMessage").value = "";
    sendToAI(msg);
  });
  </script>

</body>
</html>
