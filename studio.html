<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Webneva Studio ‚Äì AI-editor</title>
  <link rel="icon" href="images/Webneva.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-50 text-gray-900 font-[Inter]">
  <!-- Header -->
  <header class="flex items-center justify-between px-6 py-3 bg-blue-800 text-white shadow-md">
    <div class="flex items-center gap-3">
      <img src="images/Webneva.png" alt="Webneva logotyp" class="h-8 w-auto">
      <span class="font-bold text-lg">Webneva Studio</span>
    </div>
    <a href="index.html" class="bg-white text-blue-800 px-4 py-2 rounded-full text-sm font-semibold shadow hover:bg-blue-100">‚Üê Tillbaka</a>
  </header>

  <!-- Main -->
  <main class="grid md:grid-cols-2 gap-0 h-[calc(100vh-56px)]">
    <!-- Kodruta -->
    <div class="p-4 bg-white border-r border-slate-200 flex flex-col">
      <h2 class="text-lg font-semibold mb-2 text-blue-800">HTML / CSS / JS</h2>
      <textarea id="code" class="flex-1 w-full p-3 border rounded-md font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Skriv din kod h√§r..."></textarea>
      <div class="flex justify-end mt-3 gap-3">
        <button id="run-btn" class="px-5 py-2 bg-blue-700 text-white rounded-full hover:bg-blue-800 transition">
          ‚ñ∂Ô∏è Visa live
        </button>
        <button id="ai-btn" class="px-5 py-2 bg-yellow-400 text-gray-900 rounded-full hover:bg-yellow-300 transition">
          ü§ñ F√∂rb√§ttra med AI
        </button>
      </div>
    </div>

    <!-- Preview -->
    <div class="bg-slate-100 p-2">
      <iframe id="preview" class="w-full h-full rounded-md bg-white border"></iframe>
    </div>
  </main>

  <script>
    const codeInput = document.getElementById("code");
    const previewFrame = document.getElementById("preview");
    const runBtn = document.getElementById("run-btn");
    const aiBtn = document.getElementById("ai-btn");

    runBtn.addEventListener("click", () => {
      const code = codeInput.value;
      const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
      doc.open(); doc.write(code); doc.close();
    });

    aiBtn.addEventListener("click", async () => {
      const userCode = codeInput.value.trim();
      if (!userCode) return alert("Klistra in eller skriv lite kod f√∂rst!");

      aiBtn.textContent = "‚è≥ AI analyserar...";
      aiBtn.disabled = true;

      try {
        const res = await fetch("/api/openai", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: "F√∂rb√§ttra denna kod med fokus p√• design, responsivitet och modern stil:\n\n" + userCode
          })
        });

        const data = await res.json();

        if (data.reply) {
          codeInput.value = data.reply;
          const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
          doc.open(); doc.write(data.reply); doc.close();
        } else {
          alert("‚ùå Fel vid AI-anrop: " + (data.error || "Ok√§nt fel"));
        }
      } catch (err) {
        alert("‚ö†Ô∏è Kunde inte n√• AI-servern.");
        console.error(err);
      } finally {
        aiBtn.textContent = "ü§ñ F√∂rb√§ttra med AI";
        aiBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
