<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Webneva Studio ‚Äì AI f√∂r webbutvecklare</title>
  <link rel="icon" href="images/webneva-logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      background: radial-gradient(circle at 10% 10%, #e0f2fe, #f8fafc);
    }
    .glass {
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(20px);
    }
    .brand-bg { background-color: #0f4c81; }
    .brand-bg:hover { background-color: #0c3b63; }
    .chat-bubble { border-radius: 1rem; padding: .75rem 1rem; margin-bottom: .75rem; word-wrap: break-word; white-space: pre-wrap; }
    .chat-ai { background-color: #f1f5f9; align-self: flex-start; }
    .chat-user { background-color: #0f4c81; color: white; align-self: flex-end; }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

  <!-- Header -->
  <header class="w-full glass shadow-sm border-b border-slate-200 fixed top-0 left-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-8 py-4">
      <div class="flex items-center gap-3">
        <img src="images/webneva-logo.png" class="h-10 w-10" alt="Webneva logo">
        <span class="font-extrabold text-2xl text-[#0f4c81]">Webneva Studio</span>
      </div>
      <div class="relative">
        <button id="profileBtn" class="flex items-center gap-2 px-4 py-2 bg-white border rounded-full shadow hover:shadow-md transition">
          <i class="fa-solid fa-user text-slate-700"></i>
          <span class="font-medium">Profil</span>
          <i class="fa-solid fa-chevron-down text-xs"></i>
        </button>
        <div id="profileMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-slate-100">
          <a href="/" class="block px-4 py-2 text-sm hover:bg-blue-50">Tillbaka till startsida</a>
          <a href="#" class="block px-4 py-2 text-sm hover:bg-blue-50">Inst√§llningar</a>
          <hr>
          <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Logga ut</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 flex flex-col lg:flex-row justify-center gap-8 px-8 pt-28 pb-16 max-w-7xl mx-auto w-full">
    
    <!-- Kod -->
    <section class="glass p-6 rounded-2xl shadow-xl flex-1 flex flex-col h-[600px]">
      <h2 class="font-bold text-lg mb-3 text-[#0f4c81]"><i class="fa-solid fa-code"></i> Din kod</h2>
      <textarea id="userCode" class="flex-1 p-3 rounded-lg border bg-white font-mono text-sm resize-none focus:ring-2 focus:ring-blue-400" placeholder="Klistra in din HTML/CSS/JS-kod h√§r..."></textarea>
      <div class="mt-4 flex justify-end gap-3">
        <button id="previewBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90">Visa live</button>
        <button id="sendMessageBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg font-semibold shadow">‚ú® F√∂rb√§ttra med AI</button>
      </div>
    </section>

    <!-- AI -->
    <section class="glass p-6 rounded-2xl shadow-xl flex-1 flex flex-col h-[600px]">
      <h2 class="font-bold text-lg mb-3 text-[#0f4c81]"><i class="fa-solid fa-robot"></i> AI-assistent</h2>
      <div id="chatBox" class="flex flex-col flex-1 overflow-y-auto border rounded-lg bg-white p-4 text-sm mb-4">
        <div class="chat-bubble chat-ai">üëã Hej! Klistra in din kod till v√§nster och klicka p√• <strong>‚ÄùF√∂rb√§ttra med AI‚Äù</strong>.</div>
      </div>
      <textarea id="userMessage" class="w-full border rounded-lg p-2 text-sm mb-3 resize-none focus:ring-2 focus:ring-blue-400" rows="2" placeholder="Skriv till AI..."></textarea>
      <button id="sendChatBtn" class="brand-bg text-white px-5 py-2 rounded-lg font-semibold shadow hover:opacity-90">Skicka</button>
    </section>

  </main>

  <script>
  // Profilmeny
  document.getElementById("profileBtn").addEventListener("click", () => {
    document.getElementById("profileMenu").classList.toggle("hidden");
  });

  // Preview
  document.getElementById("previewBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value;
    const win = window.open("", "_blank");
    win.document.write(code);
    win.document.close();
  });

  // AI-integration
  async function sendToAI(message) {
    const chatBox = document.getElementById("chatBox");
    const userDiv = document.createElement("div");
    userDiv.className = "chat-bubble chat-user";
    userDiv.innerText = message;
    chatBox.appendChild(userDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    const thinking = document.createElement("div");
    thinking.className = "chat-bubble chat-ai italic text-gray-500";
    thinking.innerText = "‚è≥ AI bearbetar...";
    chatBox.appendChild(thinking);

    try {
      const res = await fetch("/api/openai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      chatBox.removeChild(thinking);
      const aiDiv = document.createElement("div");
      aiDiv.className = "chat-bubble chat-ai";
      aiDiv.innerText = data.reply || "‚ö†Ô∏è AI kunde inte svara.";
      chatBox.appendChild(aiDiv);
    } catch (err) {
      chatBox.removeChild(thinking);
      const errDiv = document.createElement("div");
      errDiv.className = "chat-bubble chat-ai text-red-500";
      errDiv.innerText = "‚ùå Fel vid kontakt med AI-servern.";
      chatBox.appendChild(errDiv);
    }
  }

  document.getElementById("sendMessageBtn").addEventListener("click", () => {
    const code = document.getElementById("userCode").value.trim();
    if (!code) return alert("Klistra in din kod f√∂rst!");
    sendToAI("F√∂rb√§ttra f√∂ljande kod:\n" + code);
  });

  document.getElementById("sendChatBtn").addEventListener("click", () => {
    const msg = document.getElementById("userMessage").value.trim();
    if (!msg) return alert("Skriv n√•got f√∂rst!");
    document.getElementById("userMessage").value = "";
    sendToAI(msg);
  });
  </script>
</body>
</html>
